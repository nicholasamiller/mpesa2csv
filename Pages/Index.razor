@namespace Mpesa2Csv
@page "/"
@using MPesa2Csv.Web.Dialogs
@inject ISnackbar Snackbar
@inject IDialogService DialogService


<PageTitle>Mpesa PDF to CSV converter</PageTitle>
<MudFileUpload T="IBrowserFile" FilesChanged="UploadFiles" Accept=".pdf">
    <ButtonTemplate>
        <MudButton HtmlTag="label"
                   Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Filled.CloudUpload"
                   for="@context">
            Upload Files
        </MudButton>
    </ButtonTemplate>
</MudFileUpload>


@code {

    //IList<IBrowserFile> files = new List<IBrowserFile>();
    private void UploadFiles(IBrowserFile file)
    {
        var fileStream = file.OpenReadStream();
        
        OpenPasswordDialog(fileStream);

    }

    private async Task OpenPasswordDialog(Stream fileStream)
    {
        var options = new DialogOptions { CloseOnEscapeKey = true };
        var parameters = new DialogParameters();
        parameters.Add("FileStream", fileStream);
        var dialog = DialogService.Show<PasswordDialog>("PDF Password", parameters, options);
        var pdfResult = await dialog.Result;
    }
}
